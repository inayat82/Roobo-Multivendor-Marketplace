"use strict";(()=>{var e={};e.id=397,e.ids=[397],e.modules={6293:e=>{e.exports=require("@shopify/shopify-api")},5577:e=>{e.exports=require("@shopify/shopify-api/adapters/node")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6172:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c});var r={};a.r(r),a.d(r,{GET:()=>n});var s=a(3278),o=a(5002),i=a(4877),p=a(1309);async function n(e){let{getShopifyClient:t}=await a.e(618).then(a.bind(a,6618)),{getDatabase:r,users:s,vendors:o}=await a.e(554).then(a.bind(a,7554)),i=t(),n=r();if(!i||!n)return p.NextResponse.json({error:"Services not available"},{status:500});try{let{session:t}=await i.auth.callback({rawRequest:e,rawResponse:p.NextResponse});if(!t?.shop||!t?.accessToken)return p.NextResponse.json({error:"Invalid session"},{status:400});if(!await n.query.users.findFirst({where:(e,{and:a,eq:r})=>a(r(e.shopifyStoreId,t.shop),r(e.role,"super_admin"))})){let[e]=await n.insert(s).values({shopifyStoreId:t.shop,email:`admin@${t.shop}`,role:"super_admin",status:"active"}).returning();await n.insert(o).values({userId:e.id,shopId:t.shop,status:"active",approvedAt:new Date,approvedBy:e.id})}let a=`https://${t.shop}/admin/apps`;return p.NextResponse.redirect(a)}catch(e){return console.error("Shopify callback error:",e),p.NextResponse.json({error:"Callback failed"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/shopify/callback/route",pathname:"/api/auth/shopify/callback",filename:"route",bundlePath:"app/api/auth/shopify/callback/route"},resolvedPagePath:"C:\\Users\\USER-PC\\Desktop\\Vs Projects\\multivendor-marketplace\\app\\api\\auth\\shopify\\callback\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:d}=u,h="/api/auth/shopify/callback/route";function f(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:c})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[787,833],()=>a(6172));module.exports=r})();